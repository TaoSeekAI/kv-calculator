# 噪音计算模块修复清单

## 修复日期
2026-01-14

## 修复概述

根据Excel公式对比分析，对噪音计算模块进行全面修复，使其与Excel计算结果一致。

## 修复前问题

| 问题类型 | 描述 | 影响程度 |
|---------|------|---------|
| 常数错误 | N34值为2.12e-5，应为1 | 严重 - 差6个数量级 |
| 常数错误 | A_ETA_TURB值为-4，应为-4.6 | 中等 - 影响声效系数 |
| 公式简化 | 气体声效系数使用简化公式 | 严重 - 噪音偏差大 |
| 公式简化 | 液体紊流声效使用立方关系 | 中等 - 应为线性 |
| 公式缺失 | P2B/P2CE使用固定系数估算 | 中等 - 流动状态判定不准 |
| 公式缺失 | 内部声压级缺少完整系数 | 严重 - 缺少3.2×10⁹系数 |
| 公式缺失 | 透射损失缺少频率分布系数 | 中等 - 频率特性不准 |

## 修复内容清单

### 1. 常数修复 (`src/calculators/noise/constants.ts`)

| 常数名 | 修复前 | 修复后 | 说明 |
|--------|--------|--------|------|
| N34 | 2.12e-5 | 1 | xFz计算常数 |
| A_ETA_TURB | -4 | -4.6 | 紊流声效指数 |
| TL_COEF_GAS | (新增) | 7.6e-7 | 透射损失系数 |
| N14 | (新增) | 0.0049 | 设计常数 |
| CP_PIPE | (新增) | 5000 | 管壁纵波速度 m/s |

### 2. 气体噪音修复 (`src/calculators/gas-noise.ts`)

#### 2.1 流动状态判定
- **修复前**: P2B = Pvcc × 0.5, P2CE = Pvcc × 0.3 (固定系数)
- **修复后**:
  ```
  α = Pvcc / P2C
  P2B = P1/22/α × (1/γ)^(γ/(γ-1))
  P2CE = P1/22/α
  ```

#### 2.2 声效系数公式
| 状态 | 修复前 | 修复后 |
|------|--------|--------|
| State I | 10⁻⁴ × Mvc³ | 10⁻⁴ × Mvc^3.6 |
| State II | 10⁻⁴ × Mvc³ × 2 | 10⁻⁴ × Mj^(6.6×FL²) |
| State III | 10⁻⁴ × Mvc² × 5 | 10⁻⁴ × Mj^(6.6×FL²) |
| State IV | 10⁻⁴ × Mvc² × 5 | 10⁻⁴ × Mj²/2 × √2^(6.6×FL²) |
| State V | 10⁻⁴ × Mvc² × 5 | 同State IV (使用Mj5) |

#### 2.3 内部声压级公式
- **修复前**: `Lpi = 10 × log₁₀(Wa/W₀)`
- **修复后**: `Lpi = 10 × log₁₀(3.2×10⁹ × Wa × ρ₂ × C₂ / Di²)`

#### 2.4 透射损失公式
- **修复前**: 质量定律简化公式
- **修复后**:
  ```
  TL = 10 × log₁₀((7.6×10⁻⁷) × (C₂/(tp×fp))² × Gx / ((ρ₂×C₂/(415×Gy))+1))
  ```
  其中 Gx = 1.9×10⁻³ (固定值)

#### 2.5 出口密度/声速
- **修复前**: 等熵过程 `ρ₂ = ρ₁ × (P₂/P₁)^(1/γ)`
- **修复后**: 等温过程 `ρ₂ = ρ₁ × P₂/P₁`, `C₂ = C₁`

### 3. 液体噪音修复 (`src/calculators/liquid-noise.ts`)

#### 3.1 紊流声效系数
- **修复前**: `η_turb = 10⁻⁴ × (Uvc/cL)³`
- **修复后**: `η_turb = 10^(-4.6) × (Uvc/cL)`

#### 3.2 空化声效系数
- **修复前**: 简化的强度乘数方法
- **修复后**:
  ```
  η_cav = 0.32 × η_turb × √((P₁-P₂)/ΔPc) × exp(5×xFzp) ×
          ((1-xFzp)/(1-xF))^0.5 × (xF/xFzp)^5 × (xF-xFzp)^1.5
  ```

#### 3.3 入口压力修正
- **新增**: `xFzp = xFz × (6×10⁵/P₁)^0.125`

#### 3.4 峰值频率计算
- **修复前**: `fp = 1500 × Uvc / d / 10`
- **修复后**:
  ```
  Nstr = 0.036×FL²×Kv×Fd^0.75 / (N34×xFzp^1.5×d×d₀×(P₁-Pv)^0.57)
  fp_turb = Nstr × Uvc / Dj
  fp_cav = 6×fp_turb × ((1-xF)/(1-xFzp))² × (xFzp/xF)^2.5
  ```

#### 3.5 透射损失公式
- **修复前**: `TL = 17×log₁₀(tp×ρP×fp/(ρL×cL)) - 10×log₁₀(Di)`
- **修复后**:
  ```
  TLfr = -10 - 10×log₁₀(cp×ρP×tp/(ρ₀×c₀×Di))
  ΔTL = -20×log₁₀(fr/fp + (fp/fr)^1.5)
  TL = TLfr + ΔTL
  ```

### 4. 类型定义扩展 (`src/calculators/noise/types.ts`)

新增字段:
- `GasNoiseIntermediate.Mj` - 自由膨胀射流马赫数
- `GasNoiseIntermediate.Dj` - 射流直径
- `GasNoiseIntermediate.M0` - 出口马赫数
- `GasNoiseIntermediate.Lg` - 马赫数修正

## 修复后测试结果

| 测试类型 | 测试用例 | 噪音值 | 预期范围 | 结果 |
|---------|---------|--------|---------|------|
| 液体-常规 | 水 80m³/h | 74.1 dBA | 60-90 | ✓ 通过 |
| 液体-高压差 | 水 100m³/h | 73.8 dBA | 70-100 | ✓ 通过 |
| 液体-小流量 | 水 10m³/h | 69.8 dBA | 50-80 | ✓ 通过 |
| 气体-常规 | 空气 5000Nm³/h | 100.9 dBA | 80-110 | ✓ 通过 |
| 气体-高压差 | 空气 3000Nm³/h | 97.6 dBA | 70-100 | ✓ 通过 |
| 蒸汽-常规 | 蒸汽 2000kg/h | 80.0 dBA | 65-95 | ✓ 通过 |

**总计: 6/6 测试通过 (100%)**

## 验收标准

- [x] 常数值与Excel一致
- [x] 气体噪音公式与Excel一致
- [x] 液体噪音公式与Excel一致
- [x] 所有测试用例通过
- [x] 噪音值在合理范围内

## 参考标准

- IEC 60534-8-3: 气体噪音预测（空气动力学噪声）
- IEC 60534-8-4: 液体噪音预测（液压流体噪声）
